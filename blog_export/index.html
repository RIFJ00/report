<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>政策リサーチ開発者のブログ記事一覧</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body{font-family:'Inter','Noto Sans JP',sans-serif;}
        .list-item.active{background-color:#e0f2fe;border-left-color:#0ea5e9;}
        /* パネルの高さを固定してスクロールを有効にする */
        main.grid { height: 42rem; }
    </style>
</head>
<body class="bg-gray-100">
    <div class="container mx-auto p-4 md:p-8">
        <header class="mb-6 text-center">
            <h1 class="text-3xl md:text-4xl font-bold text-gray-700">政策リサーチ開発者のブログ記事一覧</h1>
            <p class="text-gray-500 mt-2">更新日時: 2025/6/27 9:25:11</p>
        </header>
        <main class="grid grid-cols-1 md:grid-cols-3 gap-8">
            <div class="md:col-span-1 bg-white p-6 rounded-xl shadow-md flex flex-col h-full">
                <div class="flex-shrink-0">
                    <h2 class="text-xl font-bold mb-4">記事一覧</h2>
                    <div id="itemCount" class="text-sm text-right text-gray-600 mb-2"></div>
                    <input type="search" id="search" placeholder="検索..." class="w-full px-3 py-2 border rounded-md mb-4">
                </div>
                <div id="list" class="space-y-2 overflow-y-auto flex-grow min-h-0"></div>
                <div id="pagination-controls" class="flex justify-center items-center mt-4 flex-shrink-0"></div>
            </div>
            <div class="md:col-span-2 bg-white p-6 rounded-xl shadow-md flex flex-col h-full">
                <h2 class="text-xl font-bold mb-4 flex-shrink-0">記事のプレビュー</h2>
                <iframe id="preview" class="w-full flex-grow border rounded-lg min-h-0"></iframe>
            </div>
        </main>
    </div>
    <script>
    (function(){
        const listContainer = document.getElementById('list');
        const preview = document.getElementById('preview');
        const search = document.getElementById('search');
        const paginationControls = document.getElementById('pagination-controls');
        const itemCountEl = document.getElementById('itemCount');

        let allFiles = [];
        let currentPage = 1;
        const itemsPerPage = 100;
        let currentFilteredFiles = [];

        const escapeHtml = (str) => {
            if (!str) return '';
            const p = document.createElement('p');
            p.textContent = str;
            return p.innerHTML;
        };

        const injectResponsiveStyles = (content) => {
            const responsiveStyle = '<style>' +
                'html, body { max-width: 100% !important; overflow-x: hidden !important; padding: 0 !important; margin: 0 !important; }' +
                'body, .container, .wrapper, #main, .main, #page, .page { width: auto !important; min-width: 0 !important; max-width: 100% !important; margin-left: 1rem !important; margin-right: 1rem !important; box-sizing: border-box !important; }' +
                'img, iframe, video { max-width: 100% !important; height: auto !important; }' +
            '</style>';
            if (content.includes('</head>')) {
                return content.replace('</head>', responsiveStyle + '</head>');
            }
            return responsiveStyle + content;
        };

        const exportFile = (fileId) => {
            const fileToExport = allFiles.find(f => f.id === fileId);
            if (!fileToExport) return;
            const blob = new Blob([fileToExport.content], { type: 'text/html;charset=utf-8' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = fileToExport.title + '.html';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        };
        
        const previewFile = (fileId) => {
            const fileToDisplay = allFiles.find(f => f.id === fileId);
            if (fileToDisplay) {
                preview.srcdoc = injectResponsiveStyles(fileToDisplay.content);
                document.querySelectorAll('.list-item').forEach(el => el.classList.remove('active'));
                const activeItem = document.querySelector('.list-item[data-id="' + fileId + '"]');
                if (activeItem) activeItem.classList.add('active');
            }
        };
        
        const renderPagination = () => {
            const totalItems = currentFilteredFiles.length;
            const totalPages = Math.ceil(totalItems / itemsPerPage);
            
            const startIndex = (currentPage - 1) * itemsPerPage;
            const endIndex = Math.min(startIndex + itemsPerPage, totalItems);

            itemCountEl.textContent = totalItems + ' 件中 ' + (startIndex + 1) + ' - ' + endIndex + ' 件を表示';
            paginationControls.innerHTML = '';

            if (totalPages <= 1) return;

            paginationControls.innerHTML = 
                '<button id="prev-page" class="px-3 py-1 bg-gray-200 rounded-md hover:bg-gray-300 disabled:opacity-50 disabled:cursor-not-allowed" ' + (currentPage === 1 ? 'disabled' : '') + '>' +
                    '前へ' +
                '</button>' +
                '<span class="mx-4 text-sm font-medium text-gray-700">' +
                    currentPage + ' / ' + totalPages + ' ページ' +
                '</span>' +
                '<button id="next-page" class="px-3 py-1 bg-gray-200 rounded-md hover:bg-gray-300 disabled:opacity-50 disabled:cursor-not-allowed" ' + (currentPage === totalPages ? 'disabled' : '') + '>' +
                    '次へ' +
                '</button>';

            document.getElementById('prev-page').addEventListener('click', () => {
                if (currentPage > 1) {
                    currentPage--;
                    renderList();
                }
            });

            document.getElementById('next-page').addEventListener('click', () => {
                if (currentPage < totalPages) {
                    currentPage++;
                    renderList();
                }
            });
        };

        const renderList = () => {
            const startIndex = (currentPage - 1) * itemsPerPage;
            const endIndex = startIndex + itemsPerPage;
            const paginatedItems = currentFilteredFiles.slice(startIndex, endIndex);

            listContainer.innerHTML = '';
            
            const getISODateString = (date) => new Date(date).toISOString().slice(0, 10);
            const todayString = new Date().toISOString().slice(0, 10);
            const yesterday = new Date();
            yesterday.setDate(yesterday.getDate() - 1);
            const yesterdayString = yesterday.toISOString().slice(0, 10);

            paginatedItems.forEach(f => {
                const div = document.createElement('div');
                div.className = 'list-item p-3 flex justify-between items-center cursor-pointer hover:bg-gray-100 rounded-lg border-l-4 border-transparent';
                div.dataset.id = f.id;

                let dateClass = 'text-sm text-gray-500';
                if (f.date === todayString) {
                    dateClass = 'text-sm text-red-600 font-bold';
                } else if (f.date === yesterdayString) {
                    dateClass = 'text-sm text-red-600';
                }

                div.innerHTML = 
                    '<div class="pointer-events-none pr-2 overflow-hidden flex-grow">' +
                        '<h3 class="font-semibold truncate">' + escapeHtml(f.title) + '</h3>' +
                        '<p class="' + dateClass + '">' + (f.date || '日付未設定') + '</p>' +
                    '</div>' +
                    '<button class="export-btn-inner flex-shrink-0 p-1 rounded-full hover:bg-gray-300" data-id="' + f.id + '" title="エクスポート">' +
                        '<svg class="w-5 h-5 text-gray-500 hover:text-sky-600 transition-colors pointer-events-none" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"></path></svg>' +
                    '</button>';
                listContainer.appendChild(div);
            });
            renderPagination();
        };

        const updateView = () => {
            const term = search.value.toLowerCase();
            currentFilteredFiles = allFiles.filter(f => f.title.toLowerCase().includes(term) || f.content.toLowerCase().includes(term));
            currentPage = 1;
            renderList();

            if (currentFilteredFiles.length > 0) {
                if (!currentFilteredFiles.some(f => f.id === (document.querySelector('.list-item.active')?.dataset.id || 0))) {
                     previewFile(currentFilteredFiles[0].id);
                 }
            } else {
                 preview.srcdoc = "<div style='display:flex;align-items:center;justify-content:center;height:100%;color:#9ca3af;'>記事がありません。</div>";
            }
        }

        listContainer.addEventListener('click', (event) => {
            const exportBtn = event.target.closest('.export-btn-inner');
            if (exportBtn) {
                event.stopPropagation();
                exportFile(parseInt(exportBtn.dataset.id, 10));
                return;
            }
            
            const listItem = event.target.closest('.list-item');
            if (listItem) {
                previewFile(parseInt(listItem.dataset.id, 10));
            }
        });

        search.addEventListener('input', updateView);
        
        fetch('data.json')
            .then(response => response.json())
            .then(data => {
                allFiles = data;
                updateView();
                if (currentFilteredFiles.length > 0) {
                    previewFile(currentFilteredFiles[0].id);
                }
            })
            .catch(error => {
                console.error('Error fetching data:', error);
                listContainer.innerHTML = '<p class="text-red-500 p-4">データの読み込みに失敗しました。data.jsonファイルが同じフォルダにあるか確認してください。</p>';
            });

    })()
    </script>
</body>
</html>