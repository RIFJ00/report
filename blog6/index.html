<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>ブログ記事一覧</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Noto+Sans+JP:wght@400;500;700&display=swap" rel="stylesheet">
    <style>body{font-family:'Inter','Noto Sans JP',sans-serif;}.list-item.active{background-color:#e0f2fe;border-left-color:#0ea5e9;}.panel-height{height:calc(100vh - 10rem);max-height:60rem;}</style>
</head>
<body class="bg-gray-100 text-gray-800">
    <div class="container mx-auto p-4 md:p-6">
        <header class="mb-6 text-center"><h1 class="text-3xl md:text-4xl font-bold text-gray-700">ブログ記事一覧</h1><p class="text-gray-500 mt-2">更新日時: 2025/6/27 11:28:21</p></header>
        <main class="grid grid-cols-1 lg:grid-cols-3 gap-6 panel-height">
            <div class="lg:col-span-1 bg-white p-4 rounded-xl shadow-md flex flex-col h-full">
                <div class="flex-shrink-0">
                    <div class="relative mb-3">
                        <input type="search" id="search" placeholder="検索..." class="w-full pl-10 pr-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-sky-500 focus:border-sky-500">
                        <svg class="w-5 h-5 text-gray-400 absolute left-3 top-1/2 -translate-y-1/2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path></svg>
                    </div>
                    <div class="flex items-center space-x-2 mb-2 text-sm">
                        <select id="sortKeyExport" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-1.5"><option value="date">日付</option><option value="title">タイトル</option><option value="createdAt">登録日</option></select>
                        <select id="sortOrderExport" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-1.5"><option value="desc">降順</option><option value="asc">昇順</option></select>
                    </div>
                    <div id="pagination-controls-top" class="flex justify-center items-center space-x-2 my-2"></div>
                    <div id="itemCount" class="text-sm text-right text-gray-600 mb-2"></div>
                </div>
                <div id="list" class="space-y-2 overflow-y-auto flex-grow min-h-0 pr-1"></div>
                <div id="pagination-controls" class="flex-shrink-0 pt-3 border-t flex justify-center items-center space-x-2"></div>
            </div>
            <div class="lg:col-span-2 bg-white p-4 rounded-xl shadow-md flex flex-col h-full">
                <h2 class="text-xl font-bold mb-3 border-b pb-3 flex-shrink-0">記事プレビュー</h2>
                <iframe id="preview" class="w-full flex-grow border border-gray-200 rounded-lg min-h-0"></iframe>
            </div>
        </main>
    </div>
    <script src="./data.js"></script>
    <script>
    (function(){
        const files = (typeof blogData !== 'undefined') ? blogData : [];
        
        const getEl = id => document.getElementById(id);
        const listContainer = getEl('list'), preview = getEl('preview'), search = getEl('search'), itemCountEl = getEl('itemCount');
        const paginationControls = getEl('pagination-controls'), paginationControlsTop = getEl('pagination-controls-top');
        const sortKeySelect = getEl('sortKeyExport'), sortOrderSelect = getEl('sortOrderExport');
        let currentFilteredFiles = [];
        let currentPage = 1;
        const itemsPerPage = 10;
        let currentSort = { key: 'date', order: 'desc' };

        const escapeHtml = str => { const p = document.createElement('p'); p.textContent = str || ''; return p.innerHTML; };
        const injectResponsiveStyles = content => {
            const style = '<style>html,body{max-width:100%!important;overflow-x:hidden!important;padding:0!important;margin:0!important}body,.container,.wrapper,#main,.main,#page,.page{width:auto!important;min-width:0!important;max-width:100%!important;margin-left:1rem!important;margin-right:1rem!important;box-sizing:border-box!important}img,iframe,video{max-width:100%!important;height:auto!important}<\/style>';
            return content.includes('</head>') ? content.replace('</head>', style + '</head>') : style + content;
        };
        const previewFile = fileId => {
            const fileToDisplay = files.find(f => f.id === fileId);
            if (fileToDisplay) {
                preview.srcdoc = injectResponsiveStyles(fileToDisplay.content);
                document.querySelectorAll('.list-item').forEach(el => el.classList.remove('active'));
                const activeItem = document.querySelector(`.list-item[data-id="${fileId}"]`);
                if (activeItem) activeItem.classList.add('active');
            }
        };
        const exportSingleFile = fileId => {
            const fileToExport = files.find(f => f.id === fileId);
            if (!fileToExport) return;
            const blob = new Blob([fileToExport.content], { type: 'text/html;charset=utf-8' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `${fileToExport.title}.html`;
            a.click();
            URL.revokeObjectURL(url);
        };
        const renderPaginationInExport = (totalItems, totalPages) => {
            const controls = [paginationControls, paginationControlsTop];
            if (totalPages <= 1) {
                controls.forEach(c => c.innerHTML = '');
                return;
            }
            const prevDisabled = currentPage === 1 ? 'disabled' : '';
            const nextDisabled = currentPage === totalPages ? 'disabled' : '';
            const paginationHTML = `<button class="page-prev px-3 py-1 bg-gray-200 rounded-md hover:bg-gray-300 disabled:opacity-50" ${prevDisabled}>前へ</button><span class="text-sm font-medium">${currentPage} / ${totalPages}</span><button class="page-next px-3 py-1 bg-gray-200 rounded-md hover:bg-gray-300 disabled:opacity-50" ${nextDisabled}>次へ</button>`;
            controls.forEach(c => {
                c.innerHTML = paginationHTML;
                c.querySelector('.page-prev').addEventListener('click', () => { if (currentPage > 1) { currentPage--; renderListInExport(); }});
                c.querySelector('.page-next').addEventListener('click', () => { if (currentPage < totalPages) { currentPage++; renderListInExport(); }});
            });
        };
        const renderListInExport = () => {
            const term = search.value.toLowerCase();
            currentFilteredFiles = files.filter(f => (f.title || '').toLowerCase().includes(term) || (f.content || '').toLowerCase().includes(term));
            
            currentFilteredFiles.sort((a,b) => {
                const key = currentSort.key;
                const order = currentSort.order === 'asc' ? 1 : -1;
                const valA = a[key] || '';
                const valB = b[key] || '';
                if(valA < valB) return -1 * order;
                if(valA > valB) return 1 * order;
                return 0;
            });
            
            const totalItems = currentFilteredFiles.length;
            const totalPages = Math.ceil(totalItems / itemsPerPage);
            if (currentPage > totalPages && totalPages > 0) currentPage = totalPages;
            
            const startIndex = (currentPage - 1) * itemsPerPage;
            const endIndex = startIndex + itemsPerPage;
            const paginatedItems = currentFilteredFiles.slice(startIndex, endIndex);

            listContainer.innerHTML = '';
            
            const startItemNum = (currentPage - 1) * itemsPerPage + 1;
            const endItemNum = Math.min(currentPage * itemsPerPage, totalItems);
            itemCountEl.textContent = totalItems > 0 ? `${startItemNum} - ${endItemNum} / ${totalItems} 件` : '0 件';

            const todayString = new Date().toISOString().slice(0, 10);
            const yesterday = new Date();
            yesterday.setDate(yesterday.getDate() - 1);
            const yesterdayString = yesterday.toISOString().slice(0,10);

            paginatedItems.forEach(f => {
                const div = document.createElement('div');
                div.className = 'list-item p-3 flex justify-between items-center cursor-pointer hover:bg-gray-100 rounded-lg border-l-4 border-transparent';
                div.dataset.id = f.id;
                
                let dateClass = 'text-sm text-gray-500';
                if (f.date === todayString) {
                    dateClass = 'text-sm text-red-600 font-bold';
                } else if (f.date === yesterdayString) {
                    dateClass = 'text-sm text-red-600';
                }

                div.innerHTML = `<div class="pointer-events-none pr-2 overflow-hidden flex-grow"><h3 class="font-semibold truncate" title="${escapeHtml(f.title)}">${escapeHtml(f.title)}</h3><p class="${dateClass}">${f.date || '日付未設定'}</p></div><button class="export-btn-inner flex-shrink-0 p-2 rounded-full hover:bg-gray-300" data-id="${f.id}" title="このファイルをエクスポート"><svg class="w-5 h-5 text-gray-500 hover:text-sky-600 transition-colors pointer-events-none" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"></path></svg></button>`;
                listContainer.appendChild(div);
            });
            renderPaginationInExport(totalItems, totalPages);
            if (paginatedItems.length > 0) {
                const currentActiveId = document.querySelector('.list-item.active')?.dataset.id;
                if(!currentActiveId || !paginatedItems.some(f => f.id == currentActiveId)) {
                    previewFile(paginatedItems[0].id);
                }
            } else if (totalItems === 0) {
                preview.srcdoc = "<div style='display:flex;align-items:center;justify-content:center;height:100%;color:#9ca3af;'>記事がありません。</div>";
            }
        };

        listContainer.addEventListener('click', event => {
            const exportBtn = event.target.closest('.export-btn-inner');
            if (exportBtn) {
                event.stopPropagation();
                exportSingleFile(parseInt(exportBtn.dataset.id, 10));
                return;
            }
            const listItem = event.target.closest('.list-item');
            if (listItem) {
                previewFile(parseInt(listItem.dataset.id, 10));
            }
        });
        
        search.addEventListener('input', () => { currentPage = 1; renderListInExport(); });
        sortKeySelect.addEventListener('change', (e) => { currentSort.key = e.target.value; currentPage = 1; renderListInExport(); });
        sortOrderSelect.addEventListener('change', (e) => { currentSort.order = e.target.value; currentPage = 1; renderListInExport(); });

        renderListInExport();
    })();
    </script>
</body></html>